services:
  remote-agent:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    container_name: remote-agent
    ports:
      - "${PORT:-5100}:5100"
    volumes:
      # Persistent data
      - workspaces:/app/workspaces
      - data:/app/data
      - ssh-keys:/app/ssh-keys
      # Custom config (read-only)
      - ./config:/app/config:ro
    environment:
      # Required
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}

      # GitHub OAuth
      - GITHUB_CLIENT_ID=${GITHUB_CLIENT_ID}
      - GITHUB_CLIENT_SECRET=${GITHUB_CLIENT_SECRET}

      # Firebase Push Notifications
      - FIREBASE_PROJECT_ID=${FIREBASE_PROJECT_ID:-}
      - FIREBASE_PRIVATE_KEY=${FIREBASE_PRIVATE_KEY:-}
      - FIREBASE_CLIENT_EMAIL=${FIREBASE_CLIENT_EMAIL:-}

      # Security
      - JWT_SECRET=${JWT_SECRET}

      # App
      - APP_URL=${APP_URL:-http://localhost:5100}
      - CORS_ORIGIN=${CORS_ORIGIN:-*}
      - NODE_ENV=${NODE_ENV:-production}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5100/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

volumes:
  workspaces:
    name: remote-agent-workspaces
  data:
    name: remote-agent-data
  ssh-keys:
    name: remote-agent-ssh-keys
